ğŸš€ HÆ°á»›ng Dáº«n CÃ i Äáº·t Kubernetes TrÃªn Ubuntu (Kubeadm)
ğŸ§© 1. Cáº¥u hÃ¬nh ban Ä‘áº§u
Cáº­p nháº­t há»‡ thá»‘ng
sudo apt update && sudo apt upgrade -y

Táº¯t swap
sudo swapoff -a
sudo sed -i '/ swap / s/^/#/' /etc/fstab

Báº­t cÃ¡c module cáº§n thiáº¿t
sudo modprobe overlay
sudo modprobe br_netfilter

Kiá»ƒm tra module
lsmod | grep br_netfilter


Náº¿u cÃ³:

br_netfilter           28672  0
bridge                282624  1 br_netfilter


â†’ OK âœ…

Cáº¥u hÃ¬nh sysctl cho networking
cat <<EOF | sudo tee /etc/sysctl.d/kubernetes.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

sudo sysctl --system

ğŸ³ 2. CÃ i Ä‘áº·t container runtime (containerd)
sudo apt install -y containerd


Táº¡o file cáº¥u hÃ¬nh:

sudo mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml > /dev/null


Chá»‰nh sá»­a trong /etc/containerd/config.toml:

TÃ¬m dÃ²ng:

SystemdCgroup = false


â†’ Sá»­a thÃ nh:

SystemdCgroup = true


Khá»Ÿi Ä‘á»™ng láº¡i dá»‹ch vá»¥:

sudo systemctl restart containerd
sudo systemctl enable containerd

â˜¸ï¸ 3. CÃ i Ä‘áº·t Kubernetes (kubeadm, kubelet, kubectl)
sudo apt-get install -y apt-transport-https ca-certificates curl
sudo curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list
sudo apt update
sudo apt install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl

ğŸ§  4. Khá»Ÿi táº¡o cluster (trÃªn master node)
Kiá»ƒm tra IP LAN:
ip a | grep inet


â†’ VÃ­ dá»¥: 192.168.5.14

Khá»Ÿi táº¡o cluster:
sudo kubeadm init --apiserver-advertise-address=192.168.5.14 --pod-network-cidr=192.168.0.0/16


ğŸ§© --apiserver-advertise-address lÃ  IP LAN tháº­t cá»§a node (dÃ¹ng Ä‘á»ƒ cÃ¡c node khÃ¡c káº¿t ná»‘i vÃ o).

Sau khi init xong:

Cháº¡y cÃ¡c lá»‡nh cáº¥u hÃ¬nh cho kubectl:

mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

ğŸŒ 5. CÃ i Ä‘áº·t máº¡ng Pod (Calico)
kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.28.0/manifests/calico.yaml

ğŸ§© 6. Kiá»ƒm tra tráº¡ng thÃ¡i
kubectl get nodes
kubectl get pods -n kube-system


âœ… Náº¿u node Ready â†’ cluster Ä‘Ã£ sáºµn sÃ ng.

ğŸ§¯ 7. Lá»—i hay gáº·p & CÃ¡ch kháº¯c phá»¥c
Lá»—i	NguyÃªn nhÃ¢n	CÃ¡ch fix
br_netfilter missing	Module chÆ°a báº­t	sudo modprobe br_netfilter
Node NotReady	Calico chÆ°a cháº¡y hoáº·c máº¡ng chÆ°a setup	CÃ i láº¡i Calico, kiá»ƒm tra kubectl get pods -n kube-system
Init:CreateContainerError (Calico)	Mount propagation cá»§a root lÃ  private	sudo mount --make-shared / rá»“i kubectl delete pod -n kube-system -l k8s-app=calico-node
Connection refused khi SSH	SSH service chÆ°a cháº¡y hoáº·c firewall cháº·n	sudo systemctl enable --now ssh, kiá»ƒm tra ufw
Swap is on khi init	ChÆ°a táº¯t swap	sudo swapoff -a vÃ  sá»­a /etc/fstab
systemd cgroup driver mismatch	containerd khÃ´ng dÃ¹ng systemd	Sá»­a SystemdCgroup = true trong /etc/containerd/config.toml
ğŸ§© 8. ThÃªm worker node

TrÃªn node worker, cÃ i Ä‘áº·t giá»‘ng master (Ä‘áº¿n bÆ°á»›c cÃ i kubeadm/kubelet/kubectl).

Sau Ä‘Ã³ trÃªn master cháº¡y:

kubeadm token create --print-join-command


â†’ Copy lá»‡nh join Ä‘Ã³, cháº¡y trÃªn node worker.

âœ… 9. Kiá»ƒm tra toÃ n cluster
kubectl get nodes
kubectl get pods -A


Táº¥t cáº£ STATUS = Running â†’ OK ğŸ‰

ğŸ“˜ 10. Má»™t sá»‘ lá»‡nh há»¯u Ã­ch
Lá»‡nh	Má»¥c Ä‘Ã­ch
kubectl get nodes	Xem cÃ¡c node trong cluster
kubectl get pods -A	Xem toÃ n bá»™ pod
kubectl describe pod <tÃªn>	Chi tiáº¿t pod
kubectl logs <pod>	Xem log pod
sudo crictl ps -a	Liá»‡t kÃª container runtime
sudo crictl logs <containerID>	Xem log container thá»±c táº¿